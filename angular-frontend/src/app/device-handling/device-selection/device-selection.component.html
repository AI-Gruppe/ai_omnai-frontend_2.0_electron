<div class="flex-wrap p-4 space-y-4 flex gap-4">
  <h2 class="text-xl font-bold">Geräteauswahl</h2>

  @let isConnected = dataService.isConnected();

  <!-- Geräte laden -->
  @let loadingDevices = dataService.loadingDevices();
  <button
    class="bg-red-800 text-white p-2 rounded-md"
    (click)="dataService.getUUIDs()"
    [disabled]="loadingDevices"
  >
    {{ loadingDevices ? "Lade Geräte..." : "Geräte laden" }}
  </button>

  <!-- Gerätauswahl mit Material Checkbox -->
  <mat-list>
    @for (device of dataService.devices(); track device.UUID) {
      <mat-list-item>
        <mat-checkbox
          [checked]="selectedUUIDs().has(device.UUID)"
          [disabled]="isConnected"
          (change)="toggleDeviceSelection(device.UUID)"
        >
          {{ device.UUID }}
        </mat-checkbox>
      </mat-list-item>
    } @empty {
      <p class="text-gray-500">Keine Geräte gefunden</p>
    }
  </mat-list>

  <!-- Übersicht der ausgewählten Geräte -->
  @if (selectedUUIDs().size > 0) {
    <div class="p-2 bg-gray-200 rounded-md">
      <h3 class="text-md font-semibold mb-1">Ausgewählte Geräte:</h3>
      <ul class="list-disc pl-4 text-sm text-gray-800">
        @for (uuid of selectedUUIDs(); track uuid) {
          <li>{{ uuid }}</li>
        }
      </ul>
    </div>
  }

  <!-- Start/Stop Button -->
  <button
    class="bg-red-800 text-white p-2 rounded-md disabled:bg-gray-600"
    [disabled]="dataService.devices().length == 0"
    (click)="toggleConnection()"
  >
    {{ isConnected ? "Verbindung stoppen" : "Verbindung starten" }}
  </button>
</div>
